<!--
    This is a webpage that's divided in 3 sections

    - On the center section, there is a monaco editor that has a function template with some parameters
    - On the left section, there is a list of inputs that is used as the parameters of the function in the editor.
        There's a button to add a new parameter (input), each parameter can be removed,
        and the function template is updated accordingly
    - On the right section, it is shown the result of the function

    The function (the editor's inner text) is going to be evaluated every time any input changes,
    and the result shown in the right section
-->

<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.19.0/min/vs/loader.js"></script>
        <script>
            let editor;
            // Load monaco
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.19.0/min/vs' } });
            require(['vs/editor/editor.main'], function () {
                // Initialize the editor
                editor = monaco.editor.create(document.getElementById('editor'), {
                    value: `(inputText) => {
    return {
        reversedText: inputText.split('').reverse().join(''),
    }
}`,
                    language: 'javascript',
                    theme: 'vs-dark'
                });
                // Update the function when the editor changes
                editor.onDidChangeModelContent(evaluate);
                evaluate()
            });
        </script>
        <style>
            body {
                width: 100vw;
                min-width: 300px;
                height: 100vh;
                margin: 0;
            }
            #container {
                box-sizing: border-box;
                display: flex;
                flex-wrap: wrap;
                gap: 1em;
                width: 100%;
                height: 100%;
                padding: 2em;
            }
            #editor {
                flex-basis: 300px;
                flex-grow: 1;
            }
            #inputs, #outputs {
                flex-basis: 100px;
                flex-grow: 1;
                display: flex;
                flex-direction: column;
            }
            .output {
                display: flex;
            }
        </style>
    </head>
    <body>
        <div id="container">
            <div id="inputs"></div>
            <div id="editor"></div>
            <div id="outputs"></div>
            <script>
                const inputsDiv = document.getElementById('inputs');
                const outputsDiv = document.getElementById('outputs');

                // https://stackoverflow.com/questions/1007981/how-to-get-function-parameter-names-values-dynamically
                const STRIP_COMMENTS = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;
                const ARGUMENT_NAMES = /([^\s,]+)/g;
                /**
                 * @return {string[]}
                 */
                function getParamNames(func) {
                    const fnStr = func.toString().replace(STRIP_COMMENTS, '');
                    let result = fnStr.slice(fnStr.indexOf('(')+1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);
                    if(result === null)
                        result = [];
                    return result;
                }

                // Add input
                function addInput(name) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.placeholder = name;
                    input.id = `${name}-input`;
                    input.addEventListener('input', evaluate);
                    inputsDiv.appendChild(input);
                    return input
                }

                // Add output
                function addOutput(name) {
                    const output = document.createElement('span');
                    output.id = `${name}-output`;
                    const label = document.createElement('label');
                    label.innerText = `${name}: `;
                    const div = document.createElement('div');
                    div.class = "output"
                    div.appendChild(label);
                    div.appendChild(output);
                    outputsDiv.appendChild(div);
                    return output;
                }

                // Evaluate the function
                function evaluate () {
                    const functionText = editor.getValue();
                    const inputs = {};
                    for (input of inputsDiv.children){
                        inputs[input.id] = input.value;
                    };
                    const function_ = eval(functionText)
                    const paramNames = getParamNames(function_);
                    const params = []
                    paramNames.forEach(name => {
                        let input = document.getElementById(`${name}-input`);
                        if(input){
                            params.push(input.value);
                            return;
                        }
                        input = addInput(name);
                        params.push(input.value);
                    });
                    for (input of inputsDiv.children){
                        if(!paramNames.some(name => name === input.id.split('-')[0])){
                            input.remove();
                        }
                    };
                    const outputs = function_(...params);
                    for (let name in outputs) {
                        let output = outputsDiv.querySelector(`#${name}-output`);
                        if(!output) output = addOutput(name);
                        output.innerText = outputs[name];
                    }
                };
                for (divInput of inputsDiv.children){
                    const input = divInput.firstElementChild;
                    input.addEventListener('input', evaluate);
                };
            </script>
        </div>
    </body>
</html>